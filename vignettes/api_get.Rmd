---
title: "rCAX API query function"
description: "This vignette shows how the rCAX_GET() function works."
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{rCAX API query function}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(rCAX)
```

The main behind the scenes function is `rcax_GET(path, key = NULL, query=NULL, ...)` which appears in functions `rcax_table_query()` and `rcax_table()`.

## rcax_GET params

### path

`path` is whatever comes after `https://api.streamnet.org/api/v1` in an API call. 

So for tables the url is
```
https://api.streamnet.org/api/v1/ca
```
so `path="ca"`. I don't think you need `ca.json` since json is the default. But maybe would be good to add that to make code more robust.

### key

You should have saved this in your `.Renviron` file but if you didn't, you can pass that in in quotes, so like `key="whateveryourkeyis"`.

### query

This has to be a LIST of your query parameters (stuff that appears after `?` in the url for an API call). So like this:
```
list(table_id="whatevertableidis")
```

## rcax_nosa

So if we look at the `rcax_nosa()` code, you'll see
```
rcax_nosa_ <- function(table_id, extra = NULL, key = NULL, ...) {}
```
and then
```
rcax_GET("ca", key, query=c(list(table_id=table_id), extra))
```
so it is specifying that the url should be 
```
https://api.streamnet.org/api/v1/ca
```
Ignore the key. For the query list, it is making the list table_id and any extra query params (as a list).

For example if we wanted this call 
```
https://api.streamnet.org/api/v1/ca.json?table_id=4EF09E86-2AA8-4C98-A983-A272C2C2C7E3&XApiKey=7A2F1EA9-4882-49E8-B23D-7DC202C2ACA5&page=1&per_page=10
```
we do
```
rcax_GET("ca", key, query=list(table_id=table_id, page=1, per_page=10))
```
